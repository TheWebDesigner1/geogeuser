<!-- GeoGuessr-like Static Website (single HTML file)
Instructions: Save the contents below to a file named `index.html`. Add your Google Maps JavaScript API key in the script tag where indicated (replace YOUR_API_KEY). Host as any static website (GitHub Pages, Netlify, Vercel, or local). This is an educational prototype — do not copy GeoGuessr assets or branding for commercial use.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GeoGuessr-like Site — Prototype</title>
  <style>
    :root{--accent:#0ea5e9;--bg:#0f172a}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;display:flex;flex-direction:column;height:100vh}
    header{background:linear-gradient(90deg,#071230, #071a30);color:white;padding:12px 16px;display:flex;align-items:center;gap:12px}
    header h1{font-size:16px;margin:0}
    main{display:flex;flex:1;gap:12px;padding:12px}
    #pano{flex:1;border-radius:8px;background:#000;height:100%}
    #side{width:420px;display:flex;flex-direction:column;gap:8px}
    #map{height:60vh;border-radius:8px}
    .controls{display:flex;gap:8px}
    button{padding:8px 10px;border:0;border-radius:6px;background:var(--accent);color:#042;cursor:pointer}
    button.secondary{background:#10b981}
    .info{background:#fff;padding:10px;border-radius:8px}
    footer{font-size:12px;padding:8px 12px;color:#666}
    .muted{color:#666;font-size:13px}
  </style>
</head>
<body>
  <header>
    <h1>GeoGuessr-like — Static Website Prototype</h1>
    <div class="muted">(Save this file as <code>index.html</code> and add your Google API key)</div>
  </header>

  <main>
    <div id="pano"></div>

    <aside id="side">
      <div class="controls">
        <button id="newRound">New Round</button>
        <button id="reveal">Reveal</button>
        <button id="next" class="secondary">Next</button>
      </div>

      <div id="map"></div>

      <div class="info">
        <div>Score: <strong id="score">0</strong></div>
        <div>Round: <span id="played">0</span> / <span id="total">5</span></div>
        <div class="muted">Click the map to place your guess when a round is live. Then press Reveal.</div>
        <div id="distance" style="margin-top:8px"></div>
      </div>
    </aside>
  </main>

  <footer>
    Notes: This prototype uses the Google Maps JavaScript API & Street View Service. Replace <code>YOUR_API_KEY</code> in the script tag below. Google billing and API terms apply.
  </footer>

  <!--
    Add your API key below: replace YOUR_API_KEY. You must enable Maps JavaScript API and Street View services.
    Example:
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=geometry"></script>
  -->

  <script>
  // Minimal GeoGuessr-like logic using Google Maps JS API
  // Important: this file expects the Maps JS API to be loaded (see instructions above)

  // Small helper: haversine distance (meters)
  function haversine([lat1, lon1], [lat2, lon2]) {
    const toRad = d => d * Math.PI / 180;
    const R = 6371e3;
    const φ1 = toRad(lat1), φ2 = toRad(lat2);
    const Δφ = toRad(lat2 - lat1), Δλ = toRad(lon2 - lon1);
    const a = Math.sin(Δφ/2)**2 + Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  }

  // Random lat/lng (avoid poles extreme values)
  function randomLatLng(){
    const lat = (Math.random() * 170) - 85; // -85..85
    const lng = (Math.random() * 360) - 180;
    return {lat,lng};
  }

  // App state
  let svService, panorama, smallMap, guessMarker, actualMarker, line;
  let trueLocation = null, guessLocation = null;
  let score = 0, roundsPlayed = 0, roundsTotal = 5;

  const panoEl = document.getElementById('pano');
  const mapEl = document.getElementById('map');
  const scoreEl = document.getElementById('score');
  const playedEl = document.getElementById('played');
  const totalEl = document.getElementById('total');
  const distanceEl = document.getElementById('distance');

  totalEl.textContent = roundsTotal;

  document.getElementById('newRound').addEventListener('click', startRound);
  document.getElementById('reveal').addEventListener('click', revealRound);
  document.getElementById('next').addEventListener('click', nextRound);

  function initMapsWhenReady(){
    if (!window.google || !window.google.maps) return;
    svService = new google.maps.StreetViewService();
    // init empty panorama and map placeholders
    panorama = new google.maps.StreetViewPanorama(panoEl, {visible:false, pov:{heading:165, pitch:0}});
    smallMap = new google.maps.Map(mapEl, {center:{lat:20,lng:0}, zoom:2});

    smallMap.addListener('click', (e)=>{
      if (!panorama || !panorama.getVisible()) return; // only allow guess when round is live
      placeGuess({lat: e.latLng.lat(), lng: e.latLng.lng()});
    });
  }

  // Try to find a random panorama nearby random coords. Will attempt up to N times.
  function findRandomPanorama(attempt=0, maxAttempts=12){
    return new Promise((resolve,reject)=>{
      if (!svService) return reject(new Error('StreetViewService not initialized'));
      const tryOnce = ()=>{
        const {lat,lng} = randomLatLng();
        const loc = new google.maps.LatLng(lat,lng);
        svService.getPanorama({location: loc, radius: 50000}, (data,status)=>{
          if (status === 'OK' && data && data.location){
            resolve(data);
          } else {
            if (attempt >= maxAttempts) return reject(new Error('No panorama found. Try again.'));
            attempt++;
            setTimeout(tryOnce, 80);
          }
        });
      };
      tryOnce();
    });
  }

  async function startRound(){
    // reset UI
    guessLocation = null; trueLocation = null;
    distanceEl.textContent = '';
    if (guessMarker) { guessMarker.setMap(null); guessMarker=null; }
    if (actualMarker) { actualMarker.setMap(null); actualMarker=null; }
    if (line) { line.setMap(null); line=null; }

    try{
      const panoData = await findRandomPanorama();
      trueLocation = {lat: panoData.location.latLng.lat(), lng: panoData.location.latLng.lng()};
      panorama.setPosition(trueLocation);
      panorama.setPov({heading: Math.random()*360, pitch:0});
      panorama.setVisible(true);
      // center small map nearby
      smallMap.setCenter(trueLocation);
      smallMap.setZoom(3);
      // mark round as live by showing panorama
      console.log('Found panorama at', trueLocation);
    }catch(err){
      alert('Could not start round: ' + err.message);
    }
  }

  function placeGuess(latlng){
    guessLocation = latlng;
    if (guessMarker) guessMarker.setMap(null);
    guessMarker = new google.maps.Marker({position:latlng, map: smallMap, title:'Your guess', icon: {path:google.maps.SymbolPath.CIRCLE, scale:6}});
  }

  function revealRound(){
    if (!trueLocation) return alert('Start a round first.');
    if (!guessLocation) return alert('Make a guess on the map.');
    const dist = haversine([trueLocation.lat,trueLocation.lng],[guessLocation.lat,guessLocation.lng]);
    distanceEl.innerHTML = `<strong>Distance:</strong> ${(dist/1000).toFixed(2)} km`;
    // scoring — basic: 5000 - distance_km (clamped)
    const roundScore = Math.max(0, Math.round(5000 - dist/1000));
    score += roundScore;
    roundsPlayed += 1;
    scoreEl.textContent = score;
    playedEl.textContent = roundsPlayed;

    // show actual marker and line
    if (actualMarker) actualMarker.setMap(null);
    actualMarker = new google.maps.Marker({position:trueLocation, map: smallMap, title:'Actual location'});
    if (line) line.setMap(null);
    line = new google.maps.Polyline({path:[trueLocation, guessLocation], geodesic:true, map: smallMap});
  }

  function nextRound(){
    if (roundsPlayed >= roundsTotal){
      alert('Game over! Final score: ' + score);
      // reset game
      score = 0; roundsPlayed = 0; scoreEl.textContent = score; playedEl.textContent = roundsPlayed;
      if (guessMarker) {guessMarker.setMap(null); guessMarker=null}
      if (actualMarker) {actualMarker.setMap(null); actualMarker=null}
      if (line) {line.setMap(null); line=null}
      panorama.setVisible(false);
      smallMap.setCenter({lat:20,lng:0}); smallMap.setZoom(2);
      return;
    }
    startRound();
  }

  // Wait for Google Maps script to load and then init
  function ensureMapsLoaded(){
    if (window.google && window.google.maps){
      initMapsWhenReady();
    } else {
      setTimeout(ensureMapsLoaded, 200);
    }
  }
  ensureMapsLoaded();
  </script>

  <!--
    IMPORTANT: Add the Maps JavaScript API script tag below with your API key.
    Replace YOUR_API_KEY with your key. For example:
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=geometry"></script>

    You can place that script tag either here or in the HTML before this script block.
  -->

</body>
</html>